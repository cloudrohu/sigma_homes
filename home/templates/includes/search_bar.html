{% load static %}

{% load static %}

<div class="hidden md:block">
  <section  class="relative flex flex-col items-center justify-center text-center text-white h-[500px] bg-cover bg-center bg-no-repeat overflow-hidden" style="background-image: url('{% if settings_obj.search_bg %}{{ settings_obj.search_bg.url }}{% else %}{% static 'images/central-mumbai.jpeg' %}{% endif %}');">

    <h1 class="text-3xl md:text-4xl font-bold mb-3">Find Your Dream Property</h1>
    <p class="text-gray-300 mb-4">
      Weâ€™ve got you covered! From finding the perfect property to
      <span class="text-pink-400">Transactions</span>
    </p>

    <!-- Search Box -->
    <div class="bg-white/30 w-[90%] md:w-[55%] rounded-2xl p-3 mb-5 shadow-xl text-gray-700 backdrop-blur-sm relative">

      <!-- Filters -->
      <div class="relative flex flex-wrap items-center gap-2 rounded-md">
        <select id="propertyType" class="border rounded-md px-3 py-2 w-40">
          <option>Residential</option>
          <option>Commercial</option>
        </select>

        <div class="relative flex-grow">
          <input id="searchInput" type="text" placeholder="Select City" class="w-full border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 bg-white/90" autocomplete="off" />

          <!-- Suggestion Box -->
          <ul id="suggestionBox" class="absolute top-full left-0 right-0 mt-1 bg-white border border-gray-200 rounded-md shadow-lg max-h-60 overflow-y-auto hidden z-50"></ul>
        </div>

        <button id="searchButton" class="bg-green-500 text-white px-6 py-2 rounded-md font-semibold hover:bg-green-600 transition">
          Search
        </button>
      </div>
      
    </div>
    <div class="flex items-center gap-6 bg-gray-100 px-6 py-3 rounded-full shadow-md w-fit mx-auto">

      <!-- No Brokerage -->
      <div class="flex items-center gap-2 text-[#0b7a44] font-medium">
        <i class="fas fa-handshake text-lg"></i>
        Zero Brokerage
      </div>

      <!-- Divider -->
      <div class="h-6 w-px bg-gray-400"></div>

      <!-- Bottom Rate Policy -->
      <div class="flex items-center gap-2 text-[#0b7a44] font-medium">
        <div class="w-6 h-6">
          <!-- MahaRERA Logo -->
          <svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
            <circle cx="256" cy="256" r="240" fill="#fff" stroke="#d9362a" stroke-width="35"/>
            <circle cx="256" cy="256" r="180" fill="#fff" stroke="#000" stroke-width="10"/>
            <rect x="175" y="180" width="40" height="130" fill="#000"/>
            <rect x="225" y="150" width="40" height="160" fill="#000"/>
            <rect x="275" y="200" width="40" height="110" fill="#000"/>
            <text x="256" y="260" text-anchor="middle" font-size="70" fill="#000" font-family="Arial Black">MAHA</text>
            <text x="256" y="330" text-anchor="middle" font-size="70" fill="#000" font-family="Arial Black">RERA</text>
          </svg>
        </div>

     RERA Registered Properties
    </div>

   

    </div>

  </section>
</div>


<div class="md:hidden">
  <section  class="relative flex flex-col items-center justify-center text-center text-white h-[420px] overflow-hidden">

    <!-- âœ… Optimized Image (not CSS bg) -->
    <img src="{% if settings_obj.search_bg %}{{ settings_obj.search_bg.url }}{% else %}{% static 'images/central-mumbai.webp' %}{% endif %}" loading="eager  fetchpriority="high" class="absolute inset-0 w-full h-full object-cover" alt="Real estate background">

    <!-- Dark overlay (cheap + improves text clarity) -->
    <div class="absolute inset-0 bg-black/25"></div>

    <!-- CONTENT -->
    <div class="relative z-10 w-full px-4">

      <h2 class="text-2xl font-bold mb-2">Real Estate Made Real Easy</h2>
      <p class="text-gray-300 mb-5 text-sm">
        Weâ€™ve got you covered! From finding property to 
        <span class="text-pink-400 font-semibold">Interiors</span>
      </p>


      <!-- Search -->
      <div class="flex items-center bg-white/80 mt-5 rounded-full px-4 py-2 text-gray-700 shadow-md max-w-lg mx-auto">

        <select id="propertyTypeSelect" class="text-sm text-gray-600 bg-transparent outline-none cursor-pointer">
          <option value="residential">Residential</option>
          <option value="commercial">Commercial</option>
        </select>

        <div class="h-5 w-px bg-gray-300 mx-2"></div>

        <div class="relative flex-grow">
          <input id="mobileSearchInput" class="w-full bg-transparent outline-none text-sm" placeholder="Select City" autocomplete="off">

          <ul id="mobileSuggestionBox" class="absolute left-0 right-0 mt-1 bg-white rounded-md shadow-lg hidden max-h-60 overflow-y-auto z-50"></ul>
        </div>

        <button id="mobileSearchButton" class="ml-2">
          <i class="fas fa-search text-gray-700"></i>
        </button>

      </div>
    </div>
  </section>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {

  /* ==============================
     âš¡ Debounce Utility
  ============================== */
  function debounce(fn, delay = 350) {
    let timer;
    return (...args) => {
      clearTimeout(timer);
      timer = setTimeout(() => fn(...args), delay);
    };
  }

  /* ==============================
     ðŸ“¦ City Fetch Logic (Shared)
  ============================== */
  async function fetchCities(query, box, inputEl) {
    if (query.length < 3) {
      box.classList.add("hidden");
      return;
    }

    try {
      const res = await fetch(`/api/cities/?q=${encodeURIComponent(query)}`);
      if (!res.ok) throw new Error("Network");

      const results = await res.json();
      box.innerHTML = "";

      if (!results.length) {
        box.innerHTML = `<li class="px-4 py-2 text-sm text-gray-500">No results found</li>`;
        box.classList.remove("hidden");
        return;
      }

      results.forEach(item => {
        const li = document.createElement("li");
        li.className = "px-4 py-2 hover:bg-gray-100 cursor-pointer text-sm flex justify-between";
        li.innerHTML = `<span>${item.name}</span><span class="text-xs text-gray-400">${item.type}</span>`;

        li.onclick = () => {
          inputEl.value = item.name;
          box.classList.add("hidden");
        };

        box.appendChild(li);
      });

      box.classList.remove("hidden");

    } catch (err) {
      box.innerHTML = `<li class="px-4 py-2 text-sm text-red-500">Error loading</li>`;
      box.classList.remove("hidden");
    }
  }

  /* ==============================
     ðŸ–¥ Desktop Elements
  ============================== */
  const desktopInput = document.getElementById("searchInput");
  const desktopBox   = document.getElementById("suggestionBox");
  const desktopType  = document.getElementById("propertyType");
  const desktopBtn   = document.getElementById("searchButton");

  /* ==============================
     ðŸ“± Mobile Elements
  ============================== */
  const mobileInput = document.getElementById("mobileSearchInput");
  const mobileBox   = document.getElementById("mobileSuggestionBox");
  const mobileType  = document.getElementById("propertyTypeSelect");
  const mobileBtn   = document.getElementById("mobileSearchButton");

  /* ==============================
     âš¡ Debounced Functions
  ============================== */
  const desktopSearch = debounce(q => fetchCities(q, desktopBox, desktopInput));
  const mobileSearch  = debounce(q => fetchCities(q, mobileBox, mobileInput));

  if (desktopInput)
    desktopInput.addEventListener("input", e => desktopSearch(e.target.value));

  if (mobileInput)
    mobileInput.addEventListener("input", e => mobileSearch(e.target.value));

  /* ==============================
     ðŸšª Hide dropdown on click outside
  ============================== */
  document.addEventListener("click", e => {
    if (!e.target.closest("#searchInput")) desktopBox?.classList.add("hidden");
    if (!e.target.closest("#mobileSearchInput")) mobileBox?.classList.add("hidden");
  });

  /* ==============================
     ðŸ”Ž Search redirect (shared)
  ============================== */
  function redirect(city, type) {
    if (city.length < 2) {
      alert("Please select a valid city");
      return;
    }
    window.location.href = `/projects/search/?q=${encodeURIComponent(city)}&type=${encodeURIComponent(type)}`;
  }

  desktopBtn?.addEventListener("click", () =>
    redirect(desktopInput.value.trim(), desktopType.value.toLowerCase())
  );

  mobileBtn?.addEventListener("click", () =>
    redirect(mobileInput.value.trim(), mobileType.value.toLowerCase())
  );

  /* ==============================
     ðŸ“‘ Tabs Logic (Mobile + Desktop clean)
  ============================== */
  const tabOptions = {
    buy: ["Residential", "Commercial"],
    rental: ["Residential", "Commercial Lease", "PG / Co-living"],
    projects: ["Residential", "Commercial"]
  };

  document.querySelectorAll(".tab-btn").forEach(tab => {
    tab.addEventListener("click", () => {
      document.querySelectorAll(".tab-btn").forEach(t => t.classList.remove("bg-white","text-black","font-semibold"));

      tab.classList.add("bg-white","text-black","font-semibold");

      const selected = tab.dataset.tab;
      const targetSelect = tab.closest("#mobileTabs") ? mobileType : desktopType;

      if (!tabOptions[selected] || !targetSelect) return;

      targetSelect.innerHTML = "";

      tabOptions[selected].forEach(opt => {
        const o = document.createElement("option");
        o.textContent = opt;
        o.value = opt.toLowerCase().replace(/\s+/g,"-");
        targetSelect.appendChild(o);
      });
    });
  });

});
</script>
