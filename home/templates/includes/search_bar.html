{% load static %}

{% load static %}

<div class="hidden md:block">
  <section class="relative flex flex-col items-center text-center text-white h-[500px] bg-cover bg-center bg-no-repeat overflow-hidden pt-36" style="background-image: url('{% if settings_obj.search_bg %}{{ settings_obj.search_bg.url }}{% else %}{% static 'images/central-mumbai.jpeg' %}{% endif %}');">

    <!-- HEADING (padding kam ki) -->
    <div class=" w-[90%] md:w-[30%] rounded-2xl px-4 py-1 mb-1 mt-12 ">
      <h1 class="text-3xl md:text-4xl font-bold mb-1 text-[#555555]">Find Your Dream Property</h1>
      <p class="text-gray-700 text-base font-semibold">Start Your Journey with Us!</p>
    </div>

    <!-- SEARCH BOX -->
    <div class="bg-white/30 w-[60%] md:w-[40%] rounded-2xl p-3 shadow-xl text-gray-700 backdrop-blur-sm relative mt-3">
      <div class="relative flex items-center gap-3 rounded-md">

        <select id="propertyType" class="border rounded-md px-3 py-2 w-40 bg-white/90">
          <option>Residential</option>
          <option>Commercial</option>
        </select>

        <div class="relative flex-grow">
          <input id="searchInput" type="text" placeholder="Search Locality, Projects" class="w-full border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-400 bg-white/90" autocomplete="off"/>
          <ul id="suggestionBox" class="absolute top-full left-0 right-0 mt-1 bg-white border border-gray-200 rounded-md shadow-lg max-h-60 overflow-y-auto hidden z-50"></ul>
        </div>

      <button id="searchButton" class="bg-green-500 text-white px-6 py-2 rounded-md font-semibold hover:bg-green-600 transition">Search</button>

      </div>
    </div>

    <div class="flex flex-wrap items-center justify-center mt-3 gap-4 bg-white/80 backdrop-blur-md px-5 py-2 rounded-full shadow-md border border-gray-200 text-sm font-medium">

        <!-- Zero Brokerage -->
        <div class="flex items-center gap-2 text-[#0b7a44]">
            <i class="fas fa-handshake text-base"></i>
            <span>Zero Brokerage</span>
        </div>

        <div class="hidden sm:block h-4 w-px bg-gray-300"></div>

        <!-- RERA -->
        <div class="flex items-center gap-2 text-[#0b7a44]">
            <div class="w-5 h-5 flex items-center justify-center">
                <svg viewBox="0 0 512 512" class="w-full h-full">
                    <circle cx="256" cy="256" r="240" fill="#fff" stroke="#d9362a" stroke-width="35"/>
                    <circle cx="256" cy="256" r="180" fill="#fff" stroke="#000" stroke-width="10"/>
                    <text x="256" y="300" text-anchor="middle" font-size="120" fill="#000" font-family="Arial Black">R</text>
                </svg>
            </div>
            <span>RERA Registered</span>
        </div>

        <div class="hidden sm:block h-4 w-px bg-gray-300"></div>

        <!-- Verified -->
        <div class="flex items-center gap-2 text-[#0b7a44]">
            <img src="{% static 'projects/assets/fonts/verify.png' %}" 
                class="w-5 h-5 object-contain" 
                alt="Verified">
            <span>100% Legally Verified Projects</span>
        </div>

    </div>



  </section>
</div>

<div class="md:hidden">
  <section class="relative min-h-[420px] flex flex-col items-center justify-center text-center text-white overflow-hidden">

    <img src="{% if settings_obj.search_bg_mobile %}{{ settings_obj.search_bg_mobile.url }}{% else %}{{ settings_obj.search_bg.url }}{% endif %}" alt="Real estate background" loading="eager" fetchpriority="high" class="absolute inset-0 w-full h-full object-cover object-center" >

    <div class="absolute inset-0 bg-black/20"></div>

      <div class="relative z-10 w-full px-6 py-20">

        <h2 class="text-2xl font-bold mb-2">
          Find Your Dream Property
        </h2>

        <p class="text-gray-200 text-sm mb-6">
          Start Your Journey with Us!
        </p>

        <!-- Search -->
        <div class="flex items-center bg-white rounded-lg px-4 py-2 shadow-lg max-w-md mx-auto">

          <select id="propertyTypeSelect" class="bg-transparent text-sm text-gray-600 outline-none cursor-pointer" >
            <option value="residential">Residential</option>
            <option value="commercial">Commercial</option>
          </select>

          <div class="h-5 w-px bg-gray-300 mx-3"></div>

          <div class="relative flex-1">
            <input id="mobileSearchInput" type="text" placeholder="Search Locality, Projects" autocomplete="off" class="w-full text-sm outline-none text-gray-700" >
            <ul id="mobileSuggestionBox" class="absolute left-0 right-0 mt-2 bg-white shadow-xl hidden max-h-60 overflow-y-auto z-50">
            </ul>
          </div>

          <button id="mobileSearchButton" class="ml-3 text-gray-700">
            <i class="fas fa-search"></i>
          </button>

        </div>

      </div>

  </section>
</div>


<script>
  document.addEventListener("DOMContentLoaded", () => {

    /* ==============================
      âš¡ Debounce Utility
    ============================== */
    function debounce(fn, delay = 350) {
      let timer;
      return (...args) => {
        clearTimeout(timer);
        timer = setTimeout(() => fn(...args), delay);
      };
    }

    /* ==============================
      ðŸ“¦ City Fetch Logic (Shared)
    ============================== */
    async function fetchCities(query, box, inputEl) {
      if (query.length < 3) {
        box.classList.add("hidden");
        return;
      }

      try {
        const res = await fetch(`/api/cities/?q=${encodeURIComponent(query)}`);
        if (!res.ok) throw new Error("Network");

        const results = await res.json();
        box.innerHTML = "";

        if (!results.length) {
          box.innerHTML = `<li class="px-4 py-2 text-sm text-gray-500">No results found</li>`;
          box.classList.remove("hidden");
          return;
        }

        results.forEach(item => {
          const li = document.createElement("li");
          li.className = "px-4 py-2 hover:bg-gray-100 cursor-pointer text-sm flex justify-between";
          li.innerHTML = `<span>${item.name}</span><span class="text-xs text-gray-400">${item.type}</span>`;

          li.onclick = () => {
            inputEl.value = item.name;
            box.classList.add("hidden");
          };

          box.appendChild(li);
        });

        box.classList.remove("hidden");

      } catch (err) {
        box.innerHTML = `<li class="px-4 py-2 text-sm text-red-500">Error loading</li>`;
        box.classList.remove("hidden");
      }
    }

    /* ==============================
      ðŸ–¥ Desktop Elements
    ============================== */
    const desktopInput = document.getElementById("searchInput");
    const desktopBox   = document.getElementById("suggestionBox");
    const desktopType  = document.getElementById("propertyType");
    const desktopBtn   = document.getElementById("searchButton");

    /* ==============================
      ðŸ“± Mobile Elements
    ============================== */
    const mobileInput = document.getElementById("mobileSearchInput");
    const mobileBox   = document.getElementById("mobileSuggestionBox");
    const mobileType  = document.getElementById("propertyTypeSelect");
    const mobileBtn   = document.getElementById("mobileSearchButton");

    /* ==============================
      âš¡ Debounced Functions
    ============================== */
    const desktopSearch = debounce(q => fetchCities(q, desktopBox, desktopInput));
    const mobileSearch  = debounce(q => fetchCities(q, mobileBox, mobileInput));

    if (desktopInput)
      desktopInput.addEventListener("input", e => desktopSearch(e.target.value));

    if (mobileInput)
      mobileInput.addEventListener("input", e => mobileSearch(e.target.value));

    /* ==============================
      ðŸšª Hide dropdown on click outside
    ============================== */
    document.addEventListener("click", e => {
      if (!e.target.closest("#searchInput")) desktopBox?.classList.add("hidden");
      if (!e.target.closest("#mobileSearchInput")) mobileBox?.classList.add("hidden");
    });

    /* ==============================
      ðŸ”Ž Search redirect (shared)
    ============================== */
    function redirect(city, type) {
      if (city.length < 2) {
        alert("Please select a valid city");
        return;
      }
      window.location.href = `/projects/search/?q=${encodeURIComponent(city)}&type=${encodeURIComponent(type)}`;
    }

    desktopBtn?.addEventListener("click", () =>
      redirect(desktopInput.value.trim(), desktopType.value.toLowerCase())
    );

    mobileBtn?.addEventListener("click", () =>
      redirect(mobileInput.value.trim(), mobileType.value.toLowerCase())
    );

    /* ==============================
      ðŸ“‘ Tabs Logic (Mobile + Desktop clean)
    ============================== */
    const tabOptions = {
      buy: ["Residential", "Commercial"],
      rental: ["Residential", "Commercial Lease", "PG / Co-living"],
      projects: ["Residential", "Commercial"]
    };

    document.querySelectorAll(".tab-btn").forEach(tab => {
      tab.addEventListener("click", () => {
        document.querySelectorAll(".tab-btn").forEach(t => t.classList.remove("bg-white","text-black","font-semibold"));

        tab.classList.add("bg-white","text-black","font-semibold");

        const selected = tab.dataset.tab;
        const targetSelect = tab.closest("#mobileTabs") ? mobileType : desktopType;

        if (!tabOptions[selected] || !targetSelect) return;

        targetSelect.innerHTML = "";

        tabOptions[selected].forEach(opt => {
          const o = document.createElement("option");
          o.textContent = opt;
          o.value = opt.toLowerCase().replace(/\s+/g,"-");
          targetSelect.appendChild(o);
        });
      });
    });

  });
</script>
